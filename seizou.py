import streamlit as st
import pandas as pd


def app():

    # 材料データをデータベースに
    data = {
        "制作物名": [
            "赤ポーション*100",
            "PvP赤ポーション*100",
            "ピッケル",
            "ハエの羽*10",
            "青ポーション*100",
            "PvP青ポーション*100",
            "イグドラシルの種*3",
            "蝶の羽*10",
            "黄ポーション*100",
            "PvP黄ポーション*100",
            "イグドラシルの葉",
            "高級調理道具",
            "銀の矢筒*999",
            "イグドラシルの実",
            "軽量化ピッケル",
            "トラップツール",
            "毒薬*100",
            "修理ツール",
            "万能薬*12",
            "野外調理道具",
            "炎の矢筒*999",
            "レジストファイア",
            "火属性コンバーター",
            "紫ポーション*100",
            "PvP紫ポーション*100",
            "凍結の矢筒*999",
            "レジストコールド",
            "水属性コンバーター",
            "高級修理ツール",
            "家庭用調理道具",
            "風の矢筒*999",
            "レジストウィンド",
            "風属性コンバーター",
            "白ポーション*100",
            "PvP白ポーション*100",
            "地の矢筒*999",
            "レジストアース",
            "地属性コンバーター",
            "宮廷調理道具",
            "高級白ポーション*100",
            "高級PvP白ポーション*100",
            "ハイチ料理石炭",
        ],
        "材料": [
            ["赤ハーブ", "空の瓶"],
            ["赤ハーブ", "空の瓶"],
            ["壊れたピッケル", "砥石"],
            ["蝶の羽の粉末", "ジェル"],
            ["青ハーブ", "空の瓶"],
            ["青ハーブ", "試験管"],
            ["イグドラシルの木の枝", "アルコール"],
            ["蝶の羽の粉末", "ジェル"],
            ["黄ハーブ", "空の瓶"],
            ["黄ハーブ", "試験管"],
            ["イグドラシルの種", "アルコール"],
            ["フライパン", "珪砂"],
            ["砥石", "壊れた矢"],
            ["イグドラシルの葉", "アルコール"],
            ["ピッケル", "珪砂"],
            ["荒いトラップ", "ジェル"],
            ["毒液", "アルコール"],
            ["ハンマー", "砥石"],
            ["イグドラシルの実", "毒液"],
            ["高級調理道具", "ハンマー"],
            ["フレイムハート", "壊れた矢"],
            ["フレイムハート", "イグドラシルの露"],
            ["フレイムハート", "古い巻物"],
            ["紫ハーブ", "空の瓶"],
            ["紫ハーブ", "試験管"],
            ["ミスティックフローズン", "壊れた矢"],
            ["ミスティックフローズン", "イグドラシルの露"],
            ["ミスティックフローズン", "古い巻物"],
            ["修理ツール", "珪砂"],
            ["野外調理道具", "ハンマー"],
            ["ラフウィンド", "壊れた矢"],
            ["ラフウィンド", "イグドラシルの露"],
            ["ラフウィンド", "古い巻物"],
            ["白ハーブ", "空の瓶"],
            ["白ハーブ", "試験管"],
            ["グレートネイチャ", "壊れた矢"],
            ["グレートネイチャ", "イグドラシルの露"],
            ["グレートネイチャ", "古い巻物"],
            ["家庭用調理道具", "修理ツール"],
            ["白ハーブ", "赤ハーブ", "空の瓶"],
            ["白ハーブ", "黄ハーブ", "試験管"],
            ["宮廷調理道具", "高級修理ツール"],
        ],
        "必要数": [
            [2, 10],
            [4, 20],
            [10, 10],
            [10, 10],
            [2, 20],
            [4, 40],
            [5, 5],
            [20, 20],
            [2, 30],
            [4, 60],
            [1, 5],
            [10, 10],
            [5, 5],
            [1, 10],
            [2, 20],
            [20, 20],
            [20, 20],
            [50, 50],
            [1, 30],
            [1, 30],
            [10, 10],
            [50, 50],
            [50, 50],
            [2, 40],
            [4, 80],
            [10, 10],
            [50, 50],
            [50, 50],
            [1, 60],
            [1, 40],
            [10, 10],
            [50, 50],
            [50, 50],
            [2, 100],
            [4, 200],
            [10, 10],
            [50, 50],
            [50, 50],
            [1, 1],
            [4, 8, 250],
            [8, 16, 500],
            [1, 1],
        ],
    }

    # print(len(data["制作物名"]), len(data["材料"]), len(data["必要数"]))

    # データベースとしてDataFrameを作成
    df = pd.DataFrame(data)

    # UI部分
    st.title("製造素材計算")
    st.write("ROX用のマーチャント製造素材計算機です。")
    st.write("作りたい制作物を選択し、個数を入力してください。")
    st.write("良い感じに使ってみてください。")

    # 制作物選択
    selected_item = st.selectbox("制作物を選択", df["制作物名"])

    # 制作個数入力
    quantity = st.number_input(
        "作りたい個数", min_value=1, step=1, value=1, key="seizou_quantity"
    )

    # 制作物の情報を取得
    if selected_item:
        try:
            item_data = df[df["制作物名"] == selected_item].iloc[0]
            materials = item_data["材料"]
            material_counts = item_data["必要数"]

            # 必要素材の計算
            required_materials = {
                material: count * quantity
                for material, count in zip(materials, material_counts)
            }

            # 結果を表示
            st.write(
                f"**{selected_item}** を **{quantity}個** 作るには以下の素材が必要です："
            )
            for material, count in required_materials.items():
                st.write(f"- {material}: {count}個")
        except Exception as e:
            st.error(f"エラーが発生しました: {e}")
